
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarHub - Premium Car Rental Portal</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.7.12/sweetalert2.min.css" rel="stylesheet">

    <!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">



    <style>
         :root {
            --primary: #1a3a5f;
            --primary-light: #2c5282;
            --secondary: #ff6b35;
            --light-gray: #f8f9fa;
            --dark-gray: #343a40;
            --white: #ffffff;
            --danger: #dc3545;
            --success: #28a745;
            --warning: #ffc107;
            --info: #17a2b8;
        }
        :root {
            --primary: #1a3a5f;
            --primary-light: #2c5282;
            --secondary: #ff6b35;
            --light-gray: #f8f9fa;
            --dark-gray: #343a40;
            --white: #ffffff;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            background-color: var(--light-gray);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Navbar */
        .navbar {
            background-color: var(--primary);
            padding: 1rem 2rem;
            transition: all 0.3s ease;
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--white);
        }
        
        .navbar-brand span {
            color: var(--secondary);
        }
        
        .navbar-scrolled {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 0.5rem 2rem;
        }
        
        .nav-link {
            color: var(--white) !important;
            font-weight: 600;
            margin: 0 0.5rem;
            position: relative;
        }
        
        .nav-link:hover {
            color: var(--secondary) !important;
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            background-color: var(--secondary);
            bottom: 0;
            left: 0;
            transition: width 0.3s ease;
        }
        
        .nav-link:hover::after {
            width: 100%;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
        }
        
        /* Main Content */
        main {
            flex: 1;
            padding: 2rem 0;
        }
        
        /* Dashboard Cards */
        .dashboard-card {
            background-color: var(--white);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .dashboard-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--secondary);
        }
        
        /* Search Form */
        .search-form {
            background-color: var(--white);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .form-control {
            border-radius: 50px;
            padding: 0.75rem 1.5rem;
            border: 1px solid #ddd;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(26, 58, 95, 0.25);
        }
        
        .search-btn {
            border-radius: 50px;
            padding: 0.75rem 1.5rem;
            background-color: var(--secondary);
            border: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .search-btn:hover {
            background-color: #e45a2a;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 107, 53, 0.3);
        }


        
        /* Car Cards */
        .car-card {
            background-color: var(--white);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            margin-bottom: 2rem;
            height: 100%;
        }
        
        .car-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }
        
        .car-img {
            height: 200px;
            object-fit: cover;
            width: 100%;
        }
        
        .car-body {
            padding: 1.5rem;
        }
        
        .car-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        
        .car-subtitle {
            color: var(--secondary);
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .car-features {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .car-feature {
            display: flex;
            align-items: center;
        }
        
        .car-feature i {
            color: var(--secondary);
            margin-right: 0.5rem;
        }
        
        .car-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .car-price span {
            font-size: 1rem;
            color: #6c757d;
            font-weight: 400;
        }


/*search*/

.search-wrapper {
    margin-top: -1rem;
}

.search-wrapper .form-control {
    border-radius: 30px;
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    border: 1px solid #ccc;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    transition: box-shadow 0.3s ease, border-color 0.3s ease;
}

.search-wrapper .form-control:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.2rem rgba(26, 58, 95, 0.25);
}






        /* Booking Table */
        .booking-table th, .booking-table td {
            vertical-align: middle;
        }

        .booking-badge {
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-weight: 600;
        }

        .booking-badge.active {
            background-color: rgba(25, 135, 84, 0.1);
            color: #198754;
        }

        .booking-badge.pending {
            background-color: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }

        .booking-badge.completed {
            background-color: rgba(13, 110, 253, 0.1);
            color: #0d6efd;
        }

        .booking-badge.cancelled {
            background-color: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }



        /* Car Detail */
        .car-detail-img {
            height: 400px;
            object-fit: cover;
            border-radius: 10px;
        }

        .car-detail-features {
            margin: 2rem 0;
        }

        .feature-item {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .feature-icon {
            width: 40px;
            height: 40px;
            background-color: rgba(255, 107, 53, 0.1);
            color: var(--secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
        }

        /* Reviews */
        .review-card {
            background-color: var(--white);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .review-rating {
            color: #ffc107;
            margin-bottom: 0.5rem;
        }

        .review-user img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        /* Invoice */
        .invoice-card {
            background-color: var(--white);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .invoice-header {
            border-bottom: 1px solid #ddd;
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }

        .invoice-footer {
            border-top: 1px solid #ddd;
            padding-top: 1rem;
            margin-top: 2rem;
        }

        /* Footer */
        .footer {
            background-color: var(--primary);
            color: var(--white);
            padding: 2rem 0;
            margin-top: auto;
        }

        .footer-link {
            color: #ced4da;
            transition: all 0.3s ease;
        }

        .footer-link:hover {
            color: var(--secondary);
            text-decoration: none;
        }

        /* Loading Spinner */
        .spinner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .spinner-overlay.show {
            visibility: visible;
            opacity: 1;
        }

        /* Badge for notifications */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--secondary);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        /* Mpesa payment modal */
        .mpesa-input {
            letter-spacing: 2px;
            font-weight: bold;
        }

        /* Tabs for car details */
        .car-tab {
            padding: 1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .car-tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
            font-weight: 600;
        }

        /* Hide all sections by default */
        #dashboardSection, #carsSection, #bookingsSection, #profileSection, #carDetailSection, #invoiceSection {
            display: none;
        }

        /* Show dashboard by default */
        #dashboardSection {
            display: block;
        }

       
        
        /* Back to Top Button */
        .back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--secondary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 999;
        }
        
        .back-to-top.active {
            opacity: 1;
            visibility: visible;
        }
        
        .back-to-top:hover {
            background-color: #e45a2a;
            transform: translateY(-3px);
        }

        /* New Styles for Active Rentals */
        .active-rentals-container {
            max-height: 550px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .active-rentals-container::-webkit-scrollbar {
            width: 6px;
        }

        .active-rentals-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .active-rentals-container::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 10px;
        }

        .active-rentals-container::-webkit-scrollbar-thumb:hover {
            background: #e45a2a;
        }

        /* Feedback System */
        .feedback-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 50px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .feedback-badge:hover {
            background-color: var(--secondary);
        }

        .feedback-card {
            position: relative;
        }

        /* Rating stars */
        .rating-stars {
            color: #ffc107;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .rating-stars i:hover ~ i {
            color: #ced4da;
        }

        /* Booking modal */
        .booking-details-card {
            background-color: rgba(26, 58, 95, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .booking-summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .booking-summary-total {
            font-size: 1.2rem;
            font-weight: 700;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }

        /* Animation for elements */
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 991.98px) {
            .search-form .row > div {
                margin-bottom: 1rem;
            }
        }
        
        @media (max-width: 767.98px) {
            .dashboard-card {
                margin-bottom: 1rem;
            }
            
            .car-features {
                flex-direction: column;
            }
            
            .car-feature {
                margin-bottom: 0.5rem;
            }
        }




/*sytling*/
/* User Profile Panel Styling */
.user-profile-panel {
    display: flex;
    align-items: center;
    padding: 10px 15px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.user-profile-panel:hover {
    background-color: rgba(255, 255, 255, 0.2);
}

.user-avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid var(--secondary);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    margin-right: 12px;
    transition: transform 0.3s ease;
}

.user-profile-panel:hover .user-avatar {
    transform: scale(1.05);
}

.user-info {
    display: flex;
    flex-direction: column;
}

#name {
    color: var(--white);
    font-weight: 600;
    font-size: 0.95rem;
    margin: 0;
    line-height: 1.2;
    max-width: 150px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/*.user-email {*/
#email {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.8rem;
    margin: 0;
    max-width: 150px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Add this to your existing navbar styles */
.navbar .dropdown {
    display: flex;
    align-items: center;
    position: relative;
}

/* Responsive adjustments */
@media (max-width: 767.98px) {
    .user-profile-panel {
        padding: 8px 10px;
    }
    
    .user-avatar {
        width: 38px;
        height: 38px;
        margin-right: 10px;
    }
    
    .user-name {
        font-size: 0.85rem;
        max-width: 120px;
    }
    
    .user-email {
        font-size: 0.7rem;
        max-width: 120px;
    }
}






          /* Additional CSS for Active Rentals section */
          .active-rentals-container {
                        height: 510px;
                        overflow-y: auto;
                        position: relative;
                        padding-right: 5px;
                        /* Hide scrollbar for Chrome, Safari and Opera */
                        scrollbar-width: thin;
                        scrollbar-color: rgba(0,0,0,0.2) transparent;
                    }
                    
                    /* Custom scrollbar styling */
                    .active-rentals-container::-webkit-scrollbar {
                        width: 5px;
                    }
                    
                    .active-rentals-container::-webkit-scrollbar-track {
                        background: transparent;
                    }
                    
                    .active-rentals-container::-webkit-scrollbar-thumb {
                        background-color: rgba(0,0,0,0.2);
                        border-radius: 10px;
                    }
                    
                    .scroll-indicator {
                        position: absolute;
                        bottom: 10px;
                        left: 50%;
                        transform: translateX(-50%);
                        background-color: rgba(255,255,255,0.8);
                        padding: 5px 10px;
                        border-radius: 20px;
                        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                        z-index: 10;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        animation: pulse 2s infinite;
                    }
                    
                    .scroll-indicator i {
                        font-size: 12px;
                        color: #666;
                    }
                    
                    @keyframes pulse {
                        0% { opacity: 0.7; }
                        50% { opacity: 1; }
                        100% { opacity: 0.7; }
                    }




                    
/*Additional CSS for the Modals -->
    /* Styling for success animation */
    .success-animation {
        margin: 20px auto;
    }
    
    .checkmark-circle {
        width: 80px;
        height: 80px;
        position: relative;
        display: inline-block;
        vertical-align: top;
        margin-left: auto;
        margin-right: auto;
    }
    
    .checkmark-circle .background {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: #00C851;
        position: absolute;
    }
    
    .checkmark-circle .checkmark {
        border-radius: 5px;
    }
    
    .checkmark-circle .checkmark.draw:after {
        animation-delay: 100ms;
        animation-duration: 1s;
        animation-timing-function: ease;
        animation-name: checkmark;
        transform: scaleX(-1) rotate(135deg);
        animation-fill-mode: forwards;
    }
    
    .checkmark-circle .checkmark:after {
        opacity: 0;
        height: 40px;
        width: 20px;
        transform-origin: left top;
        border-right: 7px solid #00C851;
        border-top: 7px solid #00C851;
        border-radius: 2px !important;
        content: '';
        left: 24px;
        top: 44px;
        position: absolute;
    }

   
    
    @keyframes checkmark {
        0% {
            height: 0;
            width: 0;
            opacity: 1;
        }
        20% {
            height: 0;
            width: 20px;
            opacity: 1;
        }
        40% {
            height: 40px;
            width: 20px;
            opacity: 1;
        }
        100% {
            height: 40px;
            width: 20px;
            opacity: 1;
        }
    }
    
    /* Rating Stars */
    .rating-stars i {
        font-size: 1.8rem;
        color: #ced4da;
        cursor: pointer;
        margin-right: 5px;
        transition: all 0.2s;
    }
    
    .rating-stars i.fas {
        color: #ffc107;
    }
    
    .rating-stars i:hover,
    .rating-stars i:hover ~ i.far {
        color: #ffc107;
    }
    
    /* Booking Summary Card */
    .booking-details-card {
        background-color: rgba(26, 58, 95, 0.05);
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
    }
    
    .booking-summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
    }
    
    .booking-summary-total {
        font-size: 1.2rem;
        font-weight: 700;
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #ddd;
        display: flex;
        justify-content: space-between;
    }
    
    /* Confirmation details */
    .confirmation-details {
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
    }
    
    /* M-Pesa input */
    .mpesa-input {
        letter-spacing: 1px;
        font-weight: 600;
    }


    

/* Toast Notifications */
.toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    min-width: 300px;
    max-width: 400px;
    z-index: 9999;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    border-radius: 6px;
    overflow: hidden;
    animation: slideIn 0.3s ease-out forwards;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.toast-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 15px;
    font-weight: 600;
}

.toast-error {
    background-color: var(--danger);
    color: white;
    padding: 12px 15px;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.toast-success {
    background-color: white;
    color: var(--success);
    padding: 12px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-left: 4px solid var(--success);
}

.toast-success strong {
    color: var(--success);
    font-weight: 600;
    margin-right: 10px;
}

.toast-message {
    flex-grow: 1;
    color: var(--success);
}

.toast-body {
    background-color: white;
    padding: 12px 15px;
    color: var(--dark-gray);
}

.toast-close {
    background: none;
    border: none;
    font-size: 1.2rem;
    line-height: 1;
    color: inherit;
    cursor: pointer;
    opacity: 0.8;
    padding: 0;
    margin-left: 15px;
}

.toast-close:hover {
    opacity: 1;
}



                    
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div class="spinner-overlay" id="loadingSpinner">
        <div class="spinner-border text-light" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#" id="logoLink">Car<span>Hub</span></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#dashboardSection" id="dashboardLink">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#cars" id="carsLink">Cars</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#bookings" id="bookingsLink">Bookings</a>
                    </li>
                     <li class="nav-item">
                        <a class="nav-link" href="#" id="bookingsLink" onclick="logout()">Logout</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <div class="position-relative me-4">
                        <a href="#" class="text-white" id="notificationsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-bell fs-5"></i>
                            <span class="notification-badge" id="notificationCount">3</span>
                        </a>
                    </div>
                    <div class="dropdown">
                        <img src="/api/placeholder/40/40" class="user-avatar" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false" alt="User">
                        <div>
                            <h6 class="mb-0" id="name">Admin User</h6>
                            <small id="email">Administrator</small>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        <!-- Dashboard Section -->
        <section id="dashboardSection">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Dashboard</h2>
                    <div>
                        <button class="btn btn-outline-primary me-2" id="refreshDashboardBtn">
                            <i class="fas fa-sync-alt me-2"></i>Refresh
                        </button>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-3">
                        <div class="dashboard-card text-center animate-fade-in">
                            <i class="fas fa-car dashboard-icon"></i>
                            <h3 id="activeRentalsCount">3</h3>
                            <p class="mb-0">Active Rentals</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="dashboard-card text-center animate-fade-in" style="animation-delay: 0.1s;">
                            <i class="fas fa-calendar-check dashboard-icon"></i>
                            <h3 id="totalBookingsCount">12</h3>
                            <p class="mb-0">Total Rentals since joining</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="dashboard-card text-center animate-fade-in" style="animation-delay: 0.2s;">
                            <i class="fas fa-money-bill-wave dashboard-icon"></i>
                            <h3 id="totalSpent">Ksh 45,600</h3>
                            <p class="mb-0">Total Spent since joining</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="dashboard-card text-center animate-fade-in" style="animation-delay: 0.3s;">
                            <i class="fas fa-medal dashboard-icon"></i>
                            <h3 id="memberStatus">Silver</h3>
                            <p class="mb-0">Member Status</p>
                        </div>
                    </div>
                </div>





                  <!-- Cars Section -->
                  <section class="section cars-section mt-4" id="cars">
                    <div class="container">
                        <div class="text-center mb-5">
                            <p class="section-subheading">EXPLORE OUR FLEET</p>
                            <h2 class="section-heading">Popular Car Models</h2>
                            <p class="mb-0">Choose from our wide range of vehicles to suit your needs and budget.</p>
                        </div>

                        <div class="search-wrapper text-center mb-4">
                            <input type="search" class="form-control d-inline-block w-50"  placeholder="Search by Car Model SUV/Sedan or Fuel Type..."   id="carSearchInput" />
                        </div>
                        
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="car-card">
                                    <img src="/api/placeholder/400/250" alt="Economy Car" class="car-img">
                                    <div class="car-body">
                                        <h3 class="car-title">Toyota Corolla</h3>
                                        <p class="car-subtitle">Economy</p>
                                        <div class="car-features">
                                            <div class="car-feature">
                                                <i class="fas fa-user"></i>
                                                <span>5 Seats</span>
                                            </div>
                                            <div class="car-feature">
                                                <i class="fas fa-suitcase"></i>
                                                <span>2 Bags</span>
                                            </div>
                                            <div class="car-feature">
                                                <i class="fas fa-gas-pump"></i>
                                                <span>Petrol</span>
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="car-price">
                                                $45 <span>/ day</span>
                                            </div>
                                            <!--button  class="btn btn-primary rent-now-btn" data-rental-id="1" data-bs-toggle="modal" data-bs-target="#rentaNowModal">
                                                Rent Now
                                            </button-->

                                            <button  class="btn btn-primary rent-now-btn"  data-bs-toggle="modal" data-bs-target=  "#rentNowModal">
                                                Rent Now
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </section>



<section>
                        <div class="row mt-4" id="bookings">
                            <!-- Active Rentals Column (4/12) -->
                            <div class="col-md-4">
                                <h3 class="mb-3">Active Rentals</h3>
                                <!-- Container with fixed height and overflow scroll -->
                                <div class="active-rentals-container" style="height: 500px; overflow-y: auto; position: relative;">
                                    <!-- Navigation indicators -->
                                    <div class="rental-navigation">
                                        <div class="scroll-indicator">
                                            <small class="text-muted">Scroll to view more</small>
                                            <i class="fas fa-chevron-down"></i>
                                        </div>
                                    </div>
                                    
                                    <!-- First rental card (fully visible) -->
                                    <div class="car-card feedback-card animate-fade-in">
                                        <span class="feedback-badge" data-bs-toggle="modal" data-bs-target="#feedbackModal" data-car-id="1" data-car-name="Honda CR-V">
                                            <i class="fas fa-comment me-1"></i> Feedback
                                        </span>
                                        <img src="/api/placeholder/400/250" alt="SUV" class="car-img">
                                        <div class="car-body">
                                            <h3 class="car-title">Honda CR-V</h3>
                                            <p class="car-subtitle">SUV</p>
                                            <div class="car-features">
                                                <div class="car-feature">
                                                    <i class="fas fa-user"></i>
                                                    <span>5 Seats</span>
                                                </div>
                                                <div class="car-feature">
                                                    <i class="fas fa-suitcase"></i>
                                                    <span>4 Bags</span>
                                                </div>
                                                <div class="car-feature">
                                                    <i class="fas fa-gas-pump"></i>
                                                    <span>Petrol</span>
                                                </div>
                                            </div>
                                            <div class="booking-details-card">
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span><i class="fas fa-calendar-alt me-2"></i>Start Date:</span>
                                                    <span class="fw-bold">22 Apr 2025</span>
                                                </div>
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span><i class="fas fa-calendar-check me-2"></i>End Date:</span>
                                                    <span class="fw-bold">28 Apr 2025</span>
                                                </div>
                                                <div class="d-flex justify-content-between">
                                                    <span><i class="fas fa-clock me-2"></i>Remaining:</span>
                                                    <span class="fw-bold text-success">6 days</span>
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                <div class="car-price">
                                                    $65 <span>/ day</span>
                                                </div>
                                                <button class="btn btn-primary view-rental-btn" data-rental-id="1" data-bs-toggle="modal" data-bs-target="#rentalDetailsModal">
                                                    Details
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                    
                                    <!-- Second rental card (hidden until scroll) -->
                                    <div class="car-card feedback-card animate-fade-in" style="animation-delay: 0.2s;">
                                        <span class="feedback-badge" data-bs-toggle="modal" data-bs-target="#feedbackModal" data-car-id="2" data-car-name="Toyota Camry">
                                            <i class="fas fa-comment me-1"></i> Feedback
                                        </span>
                                        <img src="/api/placeholder/400/250" alt="Sedan" class="car-img">
                                        <div class="car-body">
                                            <h3 class="car-title">Toyota Camry</h3>
                                            <p class="car-subtitle">Sedan</p>
                                            <div class="car-features">
                                                <div class="car-feature">
                                                    <i class="fas fa-user"></i>
                                                    <span>5 Seats</span>
                                                </div>
                                                <div class="car-feature">
                                                    <i class="fas fa-suitcase"></i>
                                                    <span>3 Bags</span>
                                                </div>
                                                <div class="car-feature">
                                                    <i class="fas fa-gas-pump"></i>
                                                    <span>Hybrid</span>
                                                </div>
                                            </div>
                                            <div class="booking-details-card">
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span><i class="fas fa-calendar-alt me-2"></i>Start Date:</span>
                                                    <span class="fw-bold">20 Apr 2025</span>
                                                </div>
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span><i class="fas fa-calendar-check me-2"></i>End Date:</span>
                                                    <span class="fw-bold">30 Apr 2025</span>
                                                </div>
                                                <div class="d-flex justify-content-between">
                                                    <span><i class="fas fa-clock me-2"></i>Remaining:</span>
                                                    <span class="fw-bold text-success">8 days</span>
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                <div class="car-price">
                                                    $45 <span>/ day</span>
                                                </div>
                                                <button class="btn btn-primary view-rental-btn" data-rental-id="2" data-bs-toggle="modal" data-bs-target=  "#rentNowModal">
                                                    Details
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>





                            <!-- Recent Bookings Column (8/12) -->
                            <div class="col-md-8">
                                <h3 class="mb-3">Recent Bookings</h3>
                                <div class="dashboard-card">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Car</th>
                                                    <th>From</th>
                                                    <th>To</th>
                                                    <th>Status</th>
                                                    <th>Cost</th>
                                                </tr>
                                            </thead>
                                            <tbody id="recentBookingsTable">
                                                <tr>
                                                    <td>Toyota Camry</td>
                                                    <td>22 Apr 2025</td>
                                                    <td>25 Apr 2025</td>
                                                    <td><span class="booking-badge active">Active</span></td>
                                                    <td>Ksh 3000</td>
                                                </tr>
                                                <tr>
                                                    <td>Honda CR-V</td>
                                                    <td>15 Apr 2025</td>
                                                    <td>20 Apr 2025</td>
                                                    <td><span class="booking-badge completed">Completed</span></td>
                                                    <td>Ksh 3000</td>
                                                </tr>
                                                <tr>
                                                    <td>BMW X3</td>
                                                    <td>5 Apr 2025</td>
                                                    <td>10 Apr 2025</td>
                                                    <td><span class="booking-badge completed">Completed</span></td>
                                                    <td>Ksh 3000</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>


                            
                          
                        </div>
                    </section>



                    <!-- 1. Rent Now Modal -->
<div class="modal fade" id="rentNowModal" tabindex="-1" aria-labelledby="rentNowModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="rentNowModalLabel"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!--div class="text-center mb-4">
                    <img src="/api/placeholder/300/200" alt="Car Image" id="rentModalCarImage" class="img-fluid rounded">
                </div->
                <h4 class="text-center mb-3" id="rentModalCarName">Car Model</h4-->
                
                <form id="rentNowForm">
                    <div class="mb-3">
                        <label for="pickupDate" class="form-label">Pickup Date</label>
                        <input type="date" class="form-control" id="pickupDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="rentalDuration" class="form-label">Duration (days)</label>
                        <input type="number" class="form-control" id="rentalDuration" min="1" value="1" required>
                    </div>
                    
                    <div class="booking-details-card">
                        <div class="booking-summary-item">
                            <span>Car Model:</span>
                            <span id="summaryCarModel">Toyota Camry</span>
                        </div>
                        <div class="booking-summary-item">
                            <span>Daily Rate:</span>
                            <span id="summaryDailyRate">Ksh 45</span>
                        </div>
                        <div class="booking-summary-item">
                            <span>Pickup Date:</span>
                            <span id="summaryPickupDate">--/--/----</span>
                        </div>
                        <div class="booking-summary-item">
                            <span>Return Date:</span>
                            <span id="summaryReturnDate">--/--/----</span>
                        </div>
                        <div class="booking-summary-total">
                            <span>Total Amount:</span>
                            <span id="summaryTotalAmount">Ksh 45</span>
                        </div>
                    </div>
                    
                   
                    <div class="mt-4">
    <h5>Payment Method</h5>
    <div class="form-check d-flex align-items-center gap-2">
        <input class="form-check-input" type="radio" name="paymentMethod" id="mpesaPayment" checked>
        <label class="form-check-label mb-0" for="mpesaPayment">
            Pay with M-Pesa
        </label>
        <img src="/assets/mpesa_logo.png" alt="M-Pesa Logo" style="height: 50px; margin-left: 10px;">
    </div>
</div>

                    
                    <div class="mt-3">
                        <label for="mpesaNumber" class="form-label">M-Pesa Number <!--i>if you logged with Google</i--></label>
                        <div class="input-group">
                            <span class="input-group-text">+254</span>
                            <input type="tel" class="form-control mpesa-input" id="mpesaNumber" placeholder="7XX XXX XXX" maxlength="9" required>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="completeRentalBtn">Complete Rental</button>
            </div>
        </div>
    </div>
</div>

<!-- 2. Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">Transaction Successful</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <div class="success-animation mb-4">
                    <div class="checkmark-circle">
                        <div class="checkmark draw"></div>
                    </div>
                </div>
                <h4 class="mb-3">Payment Successful!</h4>
                <!--p class="confirmation-message">Your rental has been confirmed. A confirmation SMS has been sent to your phone.</p-->
                 <p class="confirmation-message">Your rental has been confirmed. A confirmation invoice has been sent to your email.</p>
                <div class="confirmation-details mt-4">
                    <div class="row mb-2">
                        <div class="col-5 text-start fw-bold">Car:</div>
                        <div class="col-7 text-end" id="confirmCarModel">Toyota Camry</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-5 text-start fw-bold">Pickup Date:</div>
                        <div class="col-7 text-end" id="confirmPickupDate">22 Apr 2025</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-5 text-start fw-bold">Return Date:</div>
                        <div class="col-7 text-end" id="confirmReturnDate">25 Apr 2025</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-5 text-start fw-bold">Transaction ID:</div>
                        <div class="col-7 text-end" id="confirmTransactionId">TXN-123456789</div>
                    </div>
                    <div class="row border-top pt-2 mt-2">
                        <div class="col-5 text-start fw-bold">Amount Paid:</div>
                        <div class="col-7 text-end fw-bold" id="confirmAmount">Ksh 135</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- 3. Feedback Modal -->
<div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="feedbackModalLabel">Share Your Feedback</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h5 id="feedbackCarName" class="mb-3">Car Model</h5>
                
                <!--div class="mb-3">
                    <label class="form-label">Rate your experience</label>
                    <div class="rating-stars mb-3">
                        <i class="far fa-star" data-rating="1"></i>
                        <i class="far fa-star" data-rating="2"></i>
                        <i class="far fa-star" data-rating="3"></i>
                        <i class="far fa-star" data-rating="4"></i>
                        <i class="far fa-star" data-rating="5"></i>
                    </div>
                    <input type="hidden" id="selectedRating" value="0">
                </div-->
                
                <div class="mb-3">
                    <textarea class="form-control" id="feedbackText" rows="4" placeholder="Share your experience with this car..."></textarea>
                </div>
                
                <div id="previousFeedbackContainer" class="mt-4 border-top pt-3" style="display: none;">
                    <h6>Your Previous Feedback</h6>
                    <!--div class="previous-feedback-item">
                        <div class="d-flex align-items-center mb-2">
                            <div class="previous-rating me-2">
                                <i class="fas fa-star text-warning"></i>
                                <i class="fas fa-star text-warning"></i>
                                <i class="fas fa-star text-warning"></i>
                                <i class="fas fa-star text-warning"></i>
                                <i class="far fa-star text-warning"></i>
                            </div>
                            <small class="text-muted">Posted on 15 Apr 2025</small>
                        </div-->
                        <small class="text-muted">Posted on 15 Apr 2025</small>
                        <p id="previousFeedbackText">This car was great for our family trip! Very comfortable and good on fuel consumption.</p>
                    </div>
                </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="submitFeedbackBtn">Submit Feedback</button>
            </div>
            </div>
        </div>
    </div>
</div>


<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<!-- JavaScript for Modal Functionality -->

<!-- Bootstrap 5 JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>



        // Toast functionality
const createToast = (message, type) => {
    // Remove any existing toasts first
    const existingToasts = document.querySelectorAll('.toast-container');
    existingToasts.forEach(toast => toast.remove());

    // Create toast container
    const toastContainer = document.createElement('div');
    toastContainer.className = 'toast-container';
    
    // Add appropriate class based on type
    if (type === 'error') {
        toastContainer.innerHTML = `
            <div class="toast-header toast-error">
                <strong>Error</strong>
                <button type="button" class="toast-close">×</button>
            </div>
            <div class="toast-body">
                ${message}
            </div>
        `;
    } else if (type === 'success') {
        toastContainer.innerHTML = `
            <div class="toast-success">
                <strong>Success</strong>
                <div class="toast-message">${message}</div>
                <button type="button" class="toast-close">×</button>
            </div>
        `;
    }

    // Add to document
    document.body.appendChild(toastContainer);

    // Add event listener to close button
    const closeButton = toastContainer.querySelector('.toast-close');
    if (closeButton) {
        closeButton.addEventListener('click', () => {
            toastContainer.remove();
        });
    }

    // Auto-hide after 5 seconds
    setTimeout(() => {
        if (document.body.contains(toastContainer)) {
            toastContainer.remove();
        }
    }, 5000);
};

// Function to fetch and render dashboard stats
async function fetchDashboardStats() {
    try {
        // Show loading spinner
        document.getElementById('loadingSpinner').classList.add('show');
        
        const response = await fetch('https://drivemate-1.onrender.com/api/rentals/stats/', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.success) {
            // Update dashboard stats
            document.getElementById('activeRentalsCount').textContent = data.data.active_rentals;
            document.getElementById('totalBookingsCount').textContent = data.data.total_bookings;
            document.getElementById('totalSpent').textContent = `Ksh ${data.data.total_amount_spent.toLocaleString()}`;
            document.getElementById('memberStatus').textContent = data.data.membership_status;
           

        } else {
            console.error('Failed to fetch dashboard stats:', data.message);
            // Optionally show error message to user
            //showToast('error', 'Failed to load dashboard statistics');
           
        }
    } catch (error) {
        console.error('Error fetching dashboard stats:', error);
        //showToast('error', 'Network error while loading dashboard data');
       
    } finally {
        // Hide loading spinner
        document.getElementById('loadingSpinner').classList.remove('show');
    }
}
fetchDashboardStats();

// Helper function to show toast notifications
function showToast(type, message) {
    // Adjust this according to your actual notification system
    /*Swal.fire({
        toast: true,
        position: 'top-end',
        icon: type,
        title: message,
        showConfirmButton: false,
        timer: 3000
    });*/
}











  // Active rentals and feed back
const activeRentalsContainer = document.querySelector('.active-rentals-container');
const feedbackModal = document.getElementById('feedbackModal');
const feedbackCarName = document.getElementById('feedbackCarName');
const feedbackText = document.getElementById('feedbackText');
const previousFeedbackContainer = document.getElementById('previousFeedbackContainer');
const previousFeedbackText = document.getElementById('previousFeedbackText');
const submitFeedbackBtn = document.getElementById('submitFeedbackBtn');

// Global variables
let currentCarId = null;
let currentRentalId = null;

// 1. Fetch and render active bookings from server
async function fetchActiveRentals() {
    try {
        const response = await fetch('https://drivemate-1.onrender.com/api/rentals/active_rentals/', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            renderActiveRentals(data.rentals);
        } else {
            console.error('Failed to fetch active rentals:', data.message);
            // Display error message to user
            activeRentalsContainer.innerHTML = `
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Unable to load active rentals. Please try again later.
                </div>
            `;
        }
    } catch (error) {
        console.error('Error fetching active rentals:', error);
        activeRentalsContainer.innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-circle me-2"></i>
                Network error. Please check your connection and try again.
            </div>
        `;
    }
}

// Render active rentals in the container
function renderActiveRentals(rentals) {
    // Clear the container first
    activeRentalsContainer.innerHTML = '';
    
    // Add scroll navigation indicator if there are multiple rentals
    if (rentals.length > 1) {
        const scrollIndicator = document.createElement('div');
        scrollIndicator.className = 'rental-navigation';
        scrollIndicator.innerHTML = `
            <div class="scroll-indicator">
                <small class="text-muted">Scroll to view more</small>
                <i class="fas fa-chevron-down"></i>
            </div>
        `;
        activeRentalsContainer.appendChild(scrollIndicator);
    }
    
    // If no active rentals
    if (rentals.length === 0) {
        activeRentalsContainer.innerHTML = `
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                You don't have any active rentals at the moment.
            </div>
        `;
        return;
    }
    
    // Render each rental card
    rentals.forEach((rental, index) => {
        const rentalCard = document.createElement('div');
        rentalCard.className = 'car-card feedback-card animate-fade-in';
        
        // Add animation delay based on index
        if (index > 0) {
            rentalCard.style.animationDelay = `${index * 0.2}s`;
        }
        
        // Calculate remaining days
        const endDate = new Date(rental.rental_end);
        const today = new Date();
        const remainingDays = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
        const remainingClass = remainingDays < 3 ? 'text-danger' : 'text-success';
        
        rentalCard.innerHTML = `
            <span class="feedback-badge" data-bs-toggle="modal" data-bs-target="#feedbackModal" data-car-id="${rental.car.car_id}" data-car-name="${rental.car.model}" data-rental-id="${rental.rental_id}">
                <i class="fas fa-comment me-1"></i> Feedback
            </span>
            <img src="${rental.car.image_url}" alt="${rental.model}" class="car-img">
            <div class="car-body">
                <h3 class="car-title">${rental.car.year} ${rental.car.model}</h3>
                <p class="car-subtitle">${rental.car.category}</p>
                <div class="car-features">
                    <div class="car-feature">
                        <i class="fas car-side"></i>
                        <span>${rental.car.plate_number}</span>
                    </div>
                    <div class="car-feature">
                        <i class="fas fa-cogs"></i>
                        <span>${rental.car.transmission}</span>
                    </div>
                    <div class="car-feature">
                        <i class="fas fa-gas-pump"></i>
                        <span>${rental.car.fuel_type}</span>
                    </div>
                </div>
                <div class="booking-details-card">
                    <div class="d-flex justify-content-between mb-2">
                        <span><i class="fas fa-calendar-alt me-2"></i>Start Date:</span>
                        <span class="fw-bold">${formatDate(rental.rental_start)}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span><i class="fas fa-calendar-check me-2"></i>End Date:</span>
                        <span class="fw-bold">${formatDate(rental.rental_end)}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span><i class="fas fa-clock me-2"></i>Remaining:</span>
                        <span class="fw-bold ${remainingClass}">${remainingDays} days</span>
                    </div>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <div class="car-price">
                        Ksh ${rental.total_cost} 
                    </div>
                </div>
            </div>
        `;
        
        activeRentalsContainer.appendChild(rentalCard);
    });
    
    // Add event listeners to feedback badges
    addFeedbackBadgeListeners();
}

// Format date to DD MMM YYYY
function formatDate(dateString) {
    const date = new Date(dateString);
    const day = date.getDate();
    const month = date.toLocaleString('default', { month: 'short' });
    const year = date.getFullYear();
    return `${day} ${month} ${year}`;
}


function addFeedbackBadgeListeners() {
    const feedbackBadges = document.querySelectorAll('.feedback-badge');
    
    feedbackBadges.forEach(badge => {
        badge.addEventListener('click', function() {
            // Get car and rental details from data attributes
            currentCarId = this.getAttribute('data-car-id');
            currentRentalId = this.getAttribute('data-rental-id');
            const carName = this.getAttribute('data-car-name');
            
            // Update modal title with car name
            feedbackCarName.textContent = carName;
            
            // Clear previous feedback text
            feedbackText.value = '';
            
            // Fetch previous feedback for this car
            fetchPreviousFeedback(currentCarId, currentRentalId);
        });
    });
}
//fetching [revious txt]
async function fetchPreviousFeedback(car_id,rental_id) {
   //alert(`Submitting feedback for Car ID: ${car_id}, Rental ID: ${rental_id}`);
    try {
        const response = await fetch('https://drivemate-1.onrender.com/api/feedback/client_get_feedback/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: JSON.stringify({ car_id, rental_id }),
        });
        
        const data = await response.json();
        
        if (data.success) {

            previousFeedbackContainer.innerHTML = ''; // Clear previous content
            previousFeedbackContainer.style.display = 'block';

data.data.forEach(feedback => {
    const feedbackCard = document.createElement('div');
    feedbackCard.className = 'card mb-2';
    feedbackCard.innerHTML = `
        <div class="card-body">
            <p class="card-text">${feedback.comment}</p>
            <small class="text-muted">Posted on ${formatDate(feedback.feedback_date)}</small>
        </div>
    `;
    previousFeedbackContainer.appendChild(feedbackCard);
});

           
        } else {
            // Hide previous feedback container if no feedback found
            previousFeedbackContainer.style.display = 'none';
        
        }
    } catch (error) {
        console.error('Error fetching previous feedback:', error);
        previousFeedbackContainer.style.display = 'none';
        createToast(error,'error')
    }
}

// Submit feedback
async function submitFeedback() {
    // Validate input
    if (!feedbackText.value.trim()) {
        alert('Please enter your feedback before submitting');
        return;
    }
    
    try {
        const response = await fetch('https://drivemate-1.onrender.com/api/feedback/post/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: JSON.stringify({
                car_id: currentCarId,
                comment: feedbackText.value.trim(),
                rental_id: currentRentalId,
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Show success message
           
           
            createToast(data.message,'success')
           


            // Close the modal
            const modal = bootstrap.Modal.getInstance(feedbackModal);
            modal.hide();
            alert(data.message)
            location.reload();
          
            // Refresh feedback display
            fetchPreviousFeedback(currentCarId, currentRentalId);
        } else {
            createToast(`Failed to submit feedback: ${data.message}`,'error');
        }
    } catch (error) {
        console.error('Error submitting feedback:', error);
        createToast('Network error. Please try again later.', 'error');
    }
}

// Event listeners
document.addEventListener('DOMContentLoaded', () => {
    // Fetch active rentals when page loads
    fetchActiveRentals();
    
    // Add event listener to submit feedback button
    submitFeedbackBtn.addEventListener('click', submitFeedback);
});











// Render all cars from server data
function renderCars(cars) {
    const carsContainer = document.querySelector('#cars .row');
    carsContainer.innerHTML = ''; // Clear existing content
    
    if (cars.length === 0) {
        carsContainer.innerHTML = `
            <div class="col-12 text-center py-5">
                <i class="fas fa-car-crash fa-3x mb-3 text-muted"></i>
                <h4>No cars found</h4>
                <p>Try adjusting your search or add new cars to the fleet.</p>
            </div>
        `;
        return;
    }
    
    cars.forEach(car => {
        const carCard = document.createElement('div');
        carCard.className = 'col-md-4 mb-4';
        carCard.setAttribute('data-car-id', car.id);

        carCard.innerHTML = `
            <div class="car-card">
                <img src="${car.image_url}" alt="${car.name}" class="car-img">
                <div class="car-body">
                    <h3 class="car-title">${car.year} ${car.model}</h3>
                    <p class="car-subtitle">${car.category}</p>
                    <div class="car-features">
                        <div class="car-feature">
                            <i class="fas fa-car-side"></i>
                            <span>${car.plate_number}</span>
                        </div>
                        <div class="car-feature">
                            <i class="fas fa-cogs"></i>
                            <span>${car.transmission} </span>
                        </div>
                        <div class="car-feature">
                            <i class="fas fa-gas-pump"></i>
                            <span>${car.fuelType }</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="car-price">
                           Ksh ${car.dynamic_daily_rate}
                        <div class="btn-group">
                            <button class="btn btn-primary rent-now-btn" onclick="handleRentNow('${car.id}')"> Rent Now
                        </button>
                        </div>
                    </div>
                    
                </div>
            </div>
        `
        
        carsContainer.appendChild(carCard);
    });
    
    // Add event listeners to the newly created buttons
   // addFeedbackToggleListeners();
}
 





//fetching and rendering all cars for bookings
const fetchCars=async()=> {
  
    try {
        const response = await fetch('https://drivemate-1.onrender.com/api/cars/get_cars/')

        const serverResponse = await response.json();

        if(serverResponse.success==true){
           data=serverResponse.data

           allCars = data; // Store cars in global variable for filtering
           renderCars(data);
        }

    } catch (error) {
        
            console.error('Error fetching cars:', error);
            const carsContainer = document.querySelector('#cars .row');
            carsContainer.innerHTML = `
                <div class="col-12 text-center py-5">
                    <i class="fas fa-exclamation-triangle fa-3x mb-3 text-warning"></i>
                    <h4>Failed to load cars</h4>
                    <p>There was an error loading the car data. Please try again later.</p>
                    <button class="btn btn-primary mt-3" onclick="fetchCars()">
                        <i class="fas fa-sync-alt me-2"></i>Retry
                    </button>
                </div>
            `;
        
    }


};
 fetchCars()


// Global variable to store all cars
let allCars = [];

// Search cars on each key input
function setupSearch() {

    
    //const searchInput = document.querySelector('.search-bar input');
    const searchInput=document.getElementById("carSearchInput")
    
    searchInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase().trim();
        
        if (!searchTerm) {
            renderCars(allCars);
            return;
        }
        
        const filteredCars = allCars.filter(car => {
            return (
                car.model.toLowerCase().includes(searchTerm) || 
                car.category.toLowerCase().includes(searchTerm) || 
                car.fuelType.toLowerCase().includes(searchTerm) ||
                car.transmission?.toLowerCase().includes(searchTerm)// ||
                //car.description?.toLowerCase().includes(searchTerm)
            );
        });
        
        renderCars(filteredCars);
    });
}
setupSearch()




// Function to fetch past rentals and display them in the table
function fetchPastRentals() {
    // Show loading state
    document.getElementById('recentBookingsTable').innerHTML = `
        <tr>
            <td colspan="5" class="text-center">Loading bookings...</td>
        </tr>
    `;

    // Fetch data from the API
    fetch("https://drivemate-1.onrender.com/api/rentals/past_rentals/", {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            }
        })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            renderPastRentals(data.data);
        } else {
            document.getElementById('recentBookingsTable').innerHTML = `
                <tr>
                    <td colspan="5" class="text-center text-danger">Error: ${data.message}</td>
                </tr>
            `;
        }
    })
    .catch(error => {
        console.error('Error fetching past rentals:', error);
        document.getElementById('recentBookingsTable').innerHTML = `
            <tr>
                <td colspan="5" class="text-center text-danger">Failed to load bookings. Please try again.</td>
            </tr>
        `;
    });
}fetchPastRentals()

// Format date as "Friday, 4 May"
function formatDate(dateString) {
    const date = new Date(dateString);
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    
    const dayName = days[date.getDay()];
    const day = date.getDate();
    const month = months[date.getMonth()];
    
    return `${dayName}, ${day} ${month}`;
}

// Render the past rentals in the table
function renderPastRentals(rentals) {
    const tableBody = document.getElementById('recentBookingsTable');



    
    if (rentals.length === 0) {
        tableBody.innerHTML = `
            <tr >
                <td colspan="5" class="text-center alert alert-info"> <i class="fas fa-info-circle me-2"></i>
                    No past bookings found.</td>
            </tr>
        `;
        return;
    }
    
    // Sort rentals by rental_end date (most recent first)
    rentals.sort((a, b) => new Date(b.rental_end) - new Date(a.rental_end));
    
    let tableContent = '';
    
    rentals.forEach(rental => {
        tableContent += `
            <tr>
                <td>${rental.car.model}</td>
                <td>${formatDate(rental.rental_start)}</td>
                <td>${formatDate(rental.rental_end)}</td>
                <td><span class="booking-badge completed">Completed</span></td>
                <td>Ksh ${rental.total_cost}</td>
            </tr>
        `;
    });
    
    tableBody.innerHTML = tableContent;
}



//booking logic
const handleRentNow = async (car_id) => {
   
   try {
        // Show loading state
        document.getElementById('rentNowModalLabel').textContent = 'Loading...';
        
        // Initialize and show the modal
        const rentModal = new bootstrap.Modal(document.getElementById('rentNowModal'));
        rentModal.show();
        
        // Fetch car data from the server
        const response = await fetch('https://drivemate-1.onrender.com/api/cars/car_data/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ car_id }),
            credentials: 'include'
        });
        
        const data = await response.json();
        
        if (data.success) {
            const car = data.data;
            console.log(car)
            // Populate summary section
            document.getElementById('summaryCarModel').textContent = `${car.year} ${car.model}`;
            
            // Use dynamic daily rate if available, otherwise use regular daily rate
            const dailyRate = car.dynamic_daily_rate ;//|| car.daily_rate;
            document.getElementById('summaryDailyRate').textContent = `Ksh ${dailyRate}`;
            
            // Store car data for later use
            document.getElementById('rentNowForm').dataset.carId = car.id;
            document.getElementById('rentNowForm').dataset.dailyRate = dailyRate;
            
            // Reset form fields
            document.getElementById('pickupDate').value = '';
            document.getElementById('rentalDuration').value = '1';
            document.getElementById('mpesaNumber').value = '';
            
            // Reset summary fields
            document.getElementById('summaryPickupDate').textContent = '--/--/----';
            document.getElementById('summaryReturnDate').textContent = '--/--/----';
            document.getElementById('summaryTotalAmount').textContent = `Ksh ${dailyRate}`;
            
            // Setup event listeners for date and duration changes
            setupDateAndDurationListeners();
            
            // Setup submission handler
            setupSubmissionHandler(car);
            
        } else {
            // Handle error response
            createToast('Could not load car data. Please try again.', 'error');
            rentModal.hide();
        }
    } catch (error) {
        alert('An error occurred: ' + error.message);
    }

   
};

// Function to calculate and update return date and total amount
function updateBookingSummary() {
    const pickupDateInput = document.getElementById('pickupDate');
    const durationInput = document.getElementById('rentalDuration');
    
    if (pickupDateInput.value) {
        const pickupDate = new Date(pickupDateInput.value);
        const duration = parseInt(durationInput.value) || 1;
        
        // Format pickup date for display
        const formattedPickupDate = pickupDate.toLocaleDateString('en-US', {
            year: 'numeric', 
            month: 'short', 
            day: 'numeric'
        });
        
        // Calculate return date
        const returnDate = new Date(pickupDate);
        returnDate.setDate(returnDate.getDate() + duration);
        
        // Format return date for display
        const formattedReturnDate = returnDate.toLocaleDateString('en-US', {
            year: 'numeric', 
            month: 'short', 
            day: 'numeric'
        });
        
        // Update summary section
        document.getElementById('summaryPickupDate').textContent = formattedPickupDate;
        document.getElementById('summaryReturnDate').textContent = formattedReturnDate;
        
        // Calculate and update total amount
        const dailyRate = parseFloat(document.getElementById('rentNowForm').dataset.dailyRate);
        const totalAmount = dailyRate * duration;
        document.getElementById('summaryTotalAmount').textContent = `Ksh ${totalAmount.toFixed(2)}`;
    }
}

// Function to set up event listeners for date and duration inputs
function setupDateAndDurationListeners() {
    const pickupDateInput = document.getElementById('pickupDate');
    const durationInput = document.getElementById('rentalDuration');
    
    // Set minimum date to today
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    pickupDateInput.min = `${yyyy}-${mm}-${dd}`;
    
    // Add event listeners
    pickupDateInput.addEventListener('change', updateBookingSummary);
    durationInput.addEventListener('input', function() {
        // Ensure minimum duration is 1
        if (parseInt(this.value) < 1) {
            this.value = 1;
        }
        updateBookingSummary();
    });
}

// Function to handle the submission of the rental fo
function setupSubmissionHandler(car) {
    const completeRentalBtn = document.getElementById('completeRentalBtn');
    
    completeRentalBtn.addEventListener('click', async function() {
        const form = document.getElementById('rentNowForm');
        const pickupDateInput = document.getElementById('pickupDate');
        const durationInput = document.getElementById('rentalDuration');
        const mpesaNumberInput = document.getElementById('mpesaNumber');
        
        // Basic form validation
        if (!pickupDateInput.value) {
            createToast('Please select a pickup date','error');
            return;
        }
        
        if (!mpesaNumberInput.value || mpesaNumberInput.value.length !== 9) {
            createToast('Please enter a valid M-Pesa number','error');
            return;
        }
        
        // Calculate dates and total amount
        const pickupDate = new Date(pickupDateInput.value);
        const duration = parseInt(durationInput.value) || 1;
        
        const returnDate = new Date(pickupDate);
        returnDate.setDate(returnDate.getDate() + duration);
        
        const dailyRate = parseFloat(form.dataset.dailyRate);
        const totalAmount = dailyRate * duration;
        const carId = form.dataset.carId;
        const phoneNumber = '254' + mpesaNumberInput.value;
        
       
        // Send booking data to server
        try {
            const token = localStorage.getItem("token");
            const bookingResponse = await fetch('https://drivemate-1.onrender.com/api/rentals/create/', {
                method: 'POST',
                headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
            },
                body: JSON.stringify({
                    car_id: carId,
                    rental_start: pickupDate.toISOString().split('T')[0],
                    rental_end: returnDate.toISOString().split('T')[0],
                    total_cost: totalAmount,
                    phone_number: phoneNumber
                }),
               // credentials: 'include'
            });
            
            const bookingData = await bookingResponse.json();
            
            if (bookingData.success) {
                // Handle successful booking
                //refreshing dashboard stats
                fetchActiveRentals()
                fetchDashboardStats()
                //calling confirmation modol
                showMpesaConfirmation(car, pickupDate, returnDate, totalAmount, phoneNumber, bookingData.receipt);
                console.log('Booking created successfully:', bookingData);
            } else {
                // Handle booking error
                console.error('Booking failed:', bookingData);
                //alert('Booking failed: ' + (bookingData.message || 'Unknown error'));
                createToast (`Booking failed:  ${bookingData.message}`,'error');
            }
        } catch (error) {
            console.error('Error creating booking:', error);
            alert('An error occurred while creating your booking '+error);
        }
    });
}

// Function to show booking confirmation using the existing modal
function showMpesaConfirmation(car, pickupDate, returnDate, totalAmount, phoneNumber, receipt) {
    // Hide the booking form modal
    const rentModal = bootstrap.Modal.getInstance(document.getElementById('rentNowModal'));
    if (rentModal) {
        rentModal.hide();
    }
    
    // Update confirmation modal with booking details
    document.getElementById('confirmCarModel').textContent = `${car.year} ${car.model} - ${car.plate_number}`;
    document.getElementById('confirmPickupDate').textContent = pickupDate.toLocaleDateString();
    document.getElementById('confirmReturnDate').textContent = returnDate.toLocaleDateString();
    document.getElementById('confirmAmount').textContent = `Ksh ${totalAmount.toFixed(2)}`;
    document.getElementById('confirmTransactionId').textContent = receipt;
    
    // Show the confirmation modal
    const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
    confirmationModal.show();
}






//loading user data
    async function loadUserDetails() {
    const token = localStorage.getItem("token");
//  #Pass#254//.../kl
    if (!token) {
        window.location.href = "index.html";
        return;
    }

    try {
        const response = await fetch('https://drivemate-1.onrender.com/api/users/user/', {
            method: "GET",
            headers: {
              "Authorization": `Bearer ${token}`,

                "Content-Type": "application/json"
            }
        });

        const data = await response.json();

        if (!data.success) {
            localStorage.removeItem('token');
            window.location.href = "index.html";
            return;
        }

        const user = data.user;
       

        // Optional: restrict by role
        if (user.role !== "client") {
            localStorage.removeItem('token');
            window.location.href = "index.html";
            return;
        }

        document.getElementById("userDropdown").src = user.profile_picture;
        document.getElementById("name").textContent = user.name || "Loading...";
        document.getElementById("email").textContent = user.email || "Loading...";

    } catch (error) {
        console.error("Error fetching user:", error);
       localStorage.removeItem('token');
       window.location.href = "index.html";
    }
}
//loading user data
loadUserDetails()



</script>
<script src="logout.js"></script>
                    



                   